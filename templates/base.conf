{%- set env=args.environment[env] -%}
upstream {{ args.name }} {
	{%- if args.connect.method == "sock_file" %}
    server unix:{{ args.connect.arg }} fail_timeout=0;
    {%- else %}
    server {{ env.fqdn }}:{{ args.connect.arg }};
    {% endif %}
}

server {
    {%- if env %}
    listen 80;
    {%- else %}
    listen 443;
    {% endif %}

    server_name {{ env.fqdn }};
    location / {
        proxy_pass http://{{ args.name }};
    }
}